function result=NewfORBButtonTest(window, forb, maxrepeats, maxwaittime, background, txtcol)% test fORB button responsestestfontsize=4; % %of screen respausetime=1.0;errors=0;result=-1;if 0	buttontext(forb.red,:)='red   ';	buttontext(forb.green,:)='green ';	buttontext(forb.blue,:)='blue  ';	buttontext(forb.yellow,:)='yellow';	presstext='Press the ';	buttonword=' button';	okaytext='Okay';	errortext='Wrong, you pressed the ';	noresponsetext='No response after';	pressonlyonebuttontext='Press only one button at a time!';else	buttontext(forb.red,:)='rode  ';	buttontext(forb.green,:)='groene';	buttontext(forb.blue,:)='blauwe';	buttontext(forb.yellow,:)='gele  ';	presstext='Druk op de ';	buttonword=' knop';	okaytext='Goed';	errortext='Fout, dat was de ';	noresponsetext='Geen reactie na';	pressonlyonebuttontext='Druk slechts op ŽŽn knop tegelijk!';end% set text size and type for on screen purposesscreenRect=SCREEN(window,'Rect');fontsize=round(testfontsize/100*RectWidth(screenRect)); % make a percentage of screen resolutionoldfontsize=SCREEN(window,'TextSize',fontsize);oldfont=SCREEN(window,'TextFont','Courier');oldtextStyle=SCREEN(window,'TextStyle',0);white=WhiteIndex(window);black=BlackIndex(window);if nargin<=4 | isempty(background)	background=(white+black)/2;	txtcol=white;endif nargin<=5 | isempty(txtcol)	txtcol=white;endSCREEN(window,'FillRect',background);waitsecs(pausetime);for i=1:forb.nbuttons	correct=-1;	repeats=0;	% nog herkansing inbouwen	while correct== -1 & repeats < maxrepeats		SCREEN(window,'FillRect',background);		txt=[presstext deblank(buttontext(i,:)) buttonword];		drawTextCentered( window, txt, txtcol );			%fprintf( '%s\n', txt );		% get response and measure RT		start=getsecs;		RT=-1;		response=-1;		isbuttondown = 0;		while response==-1			[isbuttondown, trigger, time, forb ]=NewfORBCheck(forb);			if isbuttondown == 1				response=1;				break;			end					if getsecs-start > maxwaittime				fprintf( '\n%s %.3f s.\n', noresponsetext, getsecs-start );				return;			end					end			if response==1			% check that only one button was pressed			npressed=0;			for j=1:forb.nbuttons				if forb.status(j)>=1					npressed=npressed+1;				end			end			if npressed == 1				% examine response				if forb.status(i)==1					txt=okaytext;					correct=1;				else					% find out which button was pressed					for j=1:forb.nbuttons						if forb.status(j)==1							break;						end					end					txt=[ errortext deblank(buttontext(j,:)) buttonword ];					repeats=repeats+1;				end			else				txt=pressonlyonebuttontext;			end			end		SCREEN(window,'FillRect',background);		drawTextCentered( window, txt, txtcol );		fprintf( '%s\n', txt );		waitsecs(pausetime);		while isbuttondown==1			[isbuttondown, trigger, time, forb ]=NewfORBCheck(forb);		end		SCREEN(window,'FillRect',background);	end % herkansing	if correct ==-1		errors=errors+1;	end	endSCREEN(window,'TextSize',oldfontsize);SCREEN(window,'TextFont',oldfont);SCREEN(window,'TextStyle',oldtextStyle);if errors==0	result=1;end