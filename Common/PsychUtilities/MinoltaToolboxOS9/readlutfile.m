clear all;lutfiledir='lutfiles';lutfilename='dummyxyzz';polyorder=3;newdac=0:255;filename=[filesep lutfiledir filesep lutfilename '.cal' ];[dac, lut(:,1), lut(:,2), lut(:,3), lut(:,4)]=textread(filename, '%f\t%f\t%f\t%f\t%f', 'headerlines', 1 );for i=1:4	[p,s] = polyfit(dac,lut(:,i),polyorder);	newlut(i,:)=polyval(p, newdac);end[n,m]=size(newlut);%return;% correct for any increases at low dac valuesfor c=1:n	for r=m-1:-1:1		if newlut(c,r+1) < newlut(c,r) | newlut(c,r) < lut(1,c)			% replace data by linearly extrapolating between previous value and first measured value			newlut(c,1:r+1)=linspace(lut(1,c), newlut(c,r+1), r+1);				break;		end	endend% save the new lut datafilename=[filesep lutfiledir filesep lutfilename '.lut1' ];fp=fopen( filename, 'w');[n,m]=size(newlut);fprintf(fp, 'DAC\tRED\tGREEN\tBLUE\tWHITE\n');for r=1:m	fprintf(fp,'%d', newdac(r));	for c=1:n		fprintf(fp,'\t%f', newlut(c,r));	end	fprintf(fp,'\n');endfclose(fp);