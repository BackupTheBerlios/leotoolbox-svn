function [filepath, exists, err]=checkFileExistence(name, dir, ext, type)% check whether a file can be openedfilepath='';exists=0;err=0;% first check whether directory exists, or can be createdif 0==mkdir(dir)	fprintf('Directory ''%s'' does not exist.\n', dir );	err=1;	returnendswitch lower(type)case 'in',	filepath=[filesep dir filesep name ext];	fp=fopen(filepath,'r');		if fp<=0		fprintf('File ''%s'' does not exist (path: ''%s'').\n', name, filepath );		exists=0;		return;	end	fclose(fp);	exists=1;case 'out',% 	if strncmp(lower(name),'test', length('test'))==1	% add random number when filename starts with 'test'% 		if myrandval==-1% 			myrandval=round(rand*1000)-1;% 		end% 		name=sprintf('%s%04d', name, myrandval ); % 	end	filepath=[filesep dir filesep name ext];	fp=fopen(filepath,'r');		if fp>0		if 1~=strncmp(lower(name), 'dummy', length('dummy')) % allow file that starts with 'dummy' to be overwritten			exists=1;			fprintf('File ''%s'' already exists (path: ''%s'').\n', name, filepath );			fclose(fp);			return;		end	end	% (re-)create file and set file type	fp=fopen(filepath,'w');	fclose(fp);	filetype(filepath,'TEXT','XCEL');otherwise,	fprintf('checkFileExistence: unknown file type ''%s''.\n', type );	err=1;end