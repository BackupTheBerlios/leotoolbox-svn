function [data, stop]=getparams(data, parameters, n)% get parameters for a particular experiment% parameters, a default values and prompts should be provided in 'parameters'% default values are extracted from 'data' fields% E.g% parameters = { 															...% 'infile',		'test',		'Name of parameter file';					...% 'outfile',		'dummy',	'Name of file to which to write results';	...% 'edffile',		'dummy',	'Name of EDF (eyelink data) file';					...% %'indir',		'input',	'Folder for parameter files';				...% %'outdir',		'output',	'Folder for result files';					...% %'locedfdir',	'edf',		'Folder for local edf files';					...% 'initializedummy',	'1',	'Init Eyelink in dummymode? (1=yes, 0=no)';	...% 'showresponse'	,'0',		'Show response? (1=yes, 0=no)';	...% 'randomized',	'1',		'Randomize trial order? (1=yes, 0=no)';	...% 'computer',		'eyelinkmac',	'Which computer are we using?';	...% % };stop=0;if n==0	dlgtext='Enter parameters for this experiment';else	dlgtext='Sorry, one of the parameters contained an error';end% First, create table of parameter names, default values and prompts% parameters = { 															...% 'infile',		'test',		'Name of parameter file';					...% 'outfile',		'dummy',	'Name of file to which to write results';	...% 'edffile',		'dummy',	'Name of EDF (eyelink data) file';					...% %'indir',		'input',	'Folder for parameter files';				...% %'outdir',		'output',	'Folder for result files';					...% %'locedfdir',	'edf',		'Folder for local edf files';					...% 'initializedummy',	'1',	'Init Eyelink in dummymode? (1=yes, 0=no)';	...% 'showresponse'	,'0',		'Show response? (1=yes, 0=no)';	...% 'randomized',	'1',		'Randomize trial order? (1=yes, 0=no)';	...% 'computer',		'eyelinkmac',	'Which computer are we using?';	...% % };% (re) set defaultsfor i = 1:size(parameters,1)	if isfield( data, parameters{i,1})		if ~isempty(str2num(parameters{i,2}))			eval([ 'parameters{' num2str(i) ',2}=num2str(data.' parameters{i,1} ');']); % for string entries		else			eval([ 'parameters{' num2str(i) ',2}=data.' parameters{i,1} ';']); % for number entries		end	else		fprintf('Field ''%s'' is missing from parameter file.\n', parameters{i,1});	endend% pop up a window to get parameter values.if 1		ParamInputs = inputdlg(parameters(:,3), dlgtext, 1, parameters(:,2), 'on');	if 1==isempty(ParamInputs)		stop=1;		return;	end	[parameters{:,2}] = deal(ParamInputs{:});end% Now assign each parameter in the table to its valuefor i = 1:size(parameters,1)	if isempty(str2num(parameters{i,2}))		eval(['data.' parameters{i,1} '=''' parameters{i,2} ''';']); % for string entries	else										eval(['data.' parameters{i,1} '=[' parameters{i,2} '];']);   % for number entries	endend