function dac=lumToDac( lum, lut, gun ) % 	find dac value for gun type 'gun' that provides certain luminance% 	'gun' can be red, green, blue or gray (1, 2, 3, 4)% 	history%	8/7/2000	FWC	converted from C%	9/2/2001	fwc	removed bug, forgot to convert from array index to dac value by subtracting 1%   050204      fwc version for new colour routines, lut is organized as dacxgunschannel={'red', 'green', 'blue', 'gray', 'unknown', 'unknown'};err_lum=0.01; % allowable error in luminancehigh = 0;middle = 0;low = 1;dac = -1; % error value[high, nluts] = size(lut);if gun>nluts	fprintf( '\nnewLumToDac err: no lut for ''%s'' channel.\n', channel{gun} );	return;endif lum > (lut(high, gun)+err_lum)	fprintf( '\nnewLumToDac err: %f cd/m2 too high for ''%s'' channel (max=%f).\n', lum, channel{gun}, lut(high, gun) );	returnendif lum < (lut(low, gun)-err_lum)	fprintf( '\nnewLumToDac err: %f cd/m2 too low for ''%s'' channel (min=%f).\n', lum, channel{gun}, lut(low, gun) );	returnendwhile high - low > 1	middle = round((high+low)/2);	if lum > lut(round(middle), gun)		low  = middle;	else		high = middle;	endendif lum > (lut(high,gun) + lut(low, gun))/2	dac = high;else	dac = low;enddac=dac-1; % convert from array index to dac value